import os
from google import genai
from google.genai import types
from PIL import Image
from io import BytesIO

key = "AIzaSyAznnbuLa9qYVADHSBG0-nDyXowbBDtn-s"

try:
    client = genai.Client(api_key=key) 
except Exception as e:
    print(f"Помилка ініціалізації Gemini Client: {e}")
    raise RuntimeError("Не вдалося підключитися до Gemini API. Перевірте ключ, переданий в genai.Client().")

prompt_text="""
пиши тільки те що я прошу без коментарів
1 рядок. вивести назву вишивкі (якщо полтавських стиль, то полтавська вишивка і т.д.)

стилі:
1-Полтавська (витончена вишивка "білим по білому", часто з рослинними мотивами)
2-Харківська/Слобожанська (геометричні візерунки, часто червоно-чорні, можуть бути щільними)
3-Київська/Центральна Україна (різноманітні геометричні та рослинні мотиви, часто червоного, чорного та білого кольорів)
4-Чернігівська (геометричні візерунки, часто червоно-чорні, іноді на білому тлі)
5-Волинська (геометричні, часто прості червоні лінії або чорні квадрати)
6-Прикарпаття/Гуцульщина (багаті, яскраві геометричні візерунки, часто з використанням різноманітних кольорів, таких як червоний, помаранчевий, зелений, жовтий)
7-Буковинська (дуже складна, щільна і часто кольорова, з геометричними та рослинними мотивами, іноді з металевими нитками)
8-Подільська (характерні чорні або червоні візерунки зі складними геометричними формами, часто з обведенням)
9-Львівська/Західна Україна (різноманітні, часто геометричні, іноді з більш розрідженими візерунками)
10-Запорізька/Південна Україна (часто простіші геометричні або рослинні мотиви, що відображають більш практичний стиль)
11-Закарпатська (барвиста, часто поєднує геометричні та рослинні елементи, іноді з більшим вільним простором)

2 рядок. використані символи (записати назви в рядок через '&') до 5 штук

список символів:
["Ромб з крапками", "S-подібні мотиви (\"вужі\")", "Ламані лінії", "Трикутники", "Ромб", "Хрест", "Розeта", "Клинці", "Троянда", "Птахи", "Листя", "Виноград", "Кривульки", "Пшеничка", "Зірка", "Ламаний хрест", "Драбинки", "Сосонки", "Квадрат", "Зигзаг", "Стилізовані квіти", "Ружа", "Барвінок", "Дубове листя", "Хмелик", "Баранячі роги", "Розетка", "Восьмикутна зірка", "Квітка-зоря", "Грона винограду", "Хміль", "Калина", "Дерево Життя", "Сніжинка", "Яблучка", "Журавель", "Квіти", "Риба", "Човен", "Маяк", "Хвиля", "Птах", "Тюльпан", "Гранат", "Гвоздика"]

3 рядок. ймовірне місто виготовлення вишиванки (<Область>, <місто>)

4 рядок. ключові технікі використані в вишиванці (записати назви в рядок через '&') до 5 штук

список технік:
["занизування (верхоплут)", "пряма гладь", "кручений шов", "низинка", "хрестик", "заволікання", "гладь", "бісер", "штапівка", "цирка (мережа)", "брижування", "кафасор", "лічильна гладь (настилування)", "вирізування", "гапт (двобічна гладь)", "стебнівка", "мережка", "лиштва (лічильна гладь)", "набирування", "лиштва", "зерновий вивід", "солов'їні вічка", "півхрестик", "тамбурний шов", "рушникові шви", "Qasnaq (тамбурний шов)", "Tatar işleme (двостороння гладь)", "букме"]

5 рядок. домінантні кольора , кольора яких найбільше на вишиванці (записати в HEX форматі в рядок через '&') до 5 штук

"""

def generate_text_from_multimodal(image_bytes: bytes) -> str:
    """
    Запит 1: Текст + Фото -> Текст (Температура 0.0)
    ...
    """
    img = Image.open(BytesIO(image_bytes))
    config = types.GenerateContentConfig(
        temperature=0.0
    )
    response = client.models.generate_content(
        model='gemini-2.5-flash',
        contents=[prompt_text, img],
        config=config
    )
    return response.text
